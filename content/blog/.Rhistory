theme(legend.position = "top",
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
gapminder_life_exp_diff <- gapminder %>%
# filter to the starting and ending years only
filter(year == 1952 | year == 2007) %>%
# ensure that the data are arranged so that 1952 is first and 2007 is second
# within each year
arrange(country, year) %>%
# for country, add a variable corresponding to the difference between life
# expectency in 2007 and 1952
group_by(country) %>%
mutate(lifeExp_diff = lifeExp[2] - lifeExp[1],
# also calculate the largest population for the country (based on the two years)
max_pop = max(pop)) %>%
ungroup() %>%
# arrange in order of the biggest difference in life expectency
arrange(lifeExp_diff) %>%
# restrict to countries with a population of at least 30,000 so we can fit
# the plot in a reasonable space
filter(max_pop > 30000000) %>%
# redefine the country varaible so that it does not have the additional
# country levels corresponding to countries that were removed in the previous
# step
mutate(country = droplevels(country)) %>%
select(country, year, continent, lifeExp, lifeExp_diff)
gapminder_life_exp_diff %>%
mutate(country = fct_inorder(country)) %>%
# for each country define a varaible for min and max life expectancy
group_by(country) %>%
mutate(max_lifeExp = max(lifeExp),
min_lifeExp = min(lifeExp)) %>%
ungroup() %>%
ggplot() +
# plot a horizontal line from min to max life expectency for each country
geom_segment(aes(x = min_lifeExp, xend = max_lifeExp,
y = country, yend = country,
col = continent), alpha = 0.5, size = 7) +
# add a point for each life expectancy data point
geom_point(aes(x = lifeExp, y = country, col = continent), size = 8) +
# add text of the country name as well as the max and min life expectency
geom_text(aes(x = min_lifeExp + 0.7, y = country,
label = paste(country, round(min_lifeExp))),
col = "grey50", hjust = "right") +
geom_text(aes(x = max_lifeExp - 0.7, y = country,
label = round(max_lifeExp)),
col = "grey50", hjust = "left") +
# choose a different color palette
scale_color_brewer(palette = "Pastel2") +
# set the title
labs(title = "Change in life expectancy",
subtitle = "Between 1952 and 2007",
x = NULL,
y = NULL,
col = "Continent") +
# remove the grey background
theme_classic() +
# remove the axes and move the legend to the top
theme(legend.position = "top",
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
gapminder %>%
filter(year == 2007) %>%
group_by(continent) %>%
mutate(continent_lifeExp = mean(lifeExp)) %>%
ungroup() %>%
select(country, continent, lifeExp, continent_lifeExp)
gapminder %>%
group_by(continent, year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
# specify global aesthetic mappings
ggplot() +
# add a points layer on top
geom_point(aes(x = year, y = avg_lifeExp)) +
geom_line(aes(x = year, y = avg_lifeExp, group = continent))
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
# Chunk 1
knitr::include_graphics("/img/tidyverse/tidyverse_all.png")
# Chunk 2
knitr::include_graphics("/img/tidyverse/tidyverse.png")
# Chunk 6
library(tidyverse)
# Chunk 7
# to download the data directly:
gapminder_orig <- read.csv("https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder-FiveYearData.csv")
# define a copy of the original dataset that we will clean and play with
gapminder <- gapminder_orig
# Chunk 8
dim(gapminder)
head(gapminder)
# Chunk 9
knitr::include_graphics("/img/tidyverse/pipe.png")
# Chunk 11
# take the gapminder dataset
gapminder %>%
# and filter to the rows whose continent is Americas and year is 2007
filter(continent == "Americas", year == 2007) %>%
# show the country and lifeExp values for these rows
select(country, lifeExp)
# Chunk 14
gapminder_filtered <- filter(gapminder, continent == "Americas", year == 2007)
gapminder_filtered_selected <- select(gapminder_filtered, country, lifeExp)
gapminder_filtered_selected
# Chunk 15
knitr::include_graphics("/img/tidyverse/dplyr.png")
# Chunk 18
gapminder %>%
select(country, gdpPercap)
# Chunk 19
gapminder %>%
select(-continent)
# Chunk 20
gapminder %>%
filter(pop > 1000000000)
# Chunk 21
gapminder %>%
filter(pop > 100000000, year == 1992)
# Chunk 22
gapminder %>%
mutate(gdp = gdpPercap * pop) %>%
head
# Chunk 23
gapminder <- gapminder %>%
mutate(gdp = gdpPercap * pop)
# Chunk 24
gapminder %>%
arrange(lifeExp) %>%
head
# Chunk 25
gapminder %>%
arrange(desc(gdpPercap)) %>%
head
# Chunk 26
gapminder %>%
arrange(year, country) %>%
head
# Chunk 27
gapminder %>%
filter(year == 2007) %>%
group_by(continent) %>%
mutate(continent_lifeExp = mean(lifeExp)) %>%
ungroup() %>%
select(country, continent, lifeExp, continent_lifeExp) %>%
head(10)
# Chunk 28
gapminder %>%
summarise(mean_lifeExp = mean(lifeExp),
total_gdp = sum(gdp))
# Chunk 29
gapminder %>%
group_by(year) %>%
summarise(mean_lifeExp = mean(lifeExp),
total_gdp = sum(gdp))
# Chunk 30
gapminder %>%
rename(gdp_per_capita = gdpPercap,
life_exp = lifeExp) %>%
head
# Chunk 31
gapminder %>%
distinct(continent)
# Chunk 32
gapminder %>%
sample_n(2)
# Chunk 33
gapminder %>%
count(continent)
# Chunk 34
gapminder %>%
transmute(gdp = gdpPercap * pop) %>%
head
# Chunk 35
knitr::include_graphics("/img/tidyverse/ggplot2.png")
# Chunk 36
ggplot(gapminder)
# Chunk 37
gapminder %>%
filter(year == 2007) %>%
ggplot()
# Chunk 38
# describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping
gapminder %>%
filter(year == 2007) %>%
ggplot() +
# add a points layer on top
geom_point(aes(x = gdpPercap, y = lifeExp))
# Chunk 39
# describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping
gapminder %>%
filter(year == 2007) %>%
ggplot() +
# add a points layer on top
geom_point(aes(x = gdpPercap, y = lifeExp)) +
# add a smoothed LOESS layer
geom_smooth(aes(x = gdpPercap, y = lifeExp), method = "loess")
# Chunk 40
# describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping
gapminder %>%
filter(year == 2007) %>%
# specify global aesthetic mappings
ggplot(aes(x = gdpPercap, y = lifeExp)) +
# add a points layer on top
geom_point() +
# add a smoothed LOESS layer
geom_smooth(method = "loess")
# Chunk 41
gapminder %>%
# calcualte the average life expectency for each year
group_by(year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
ungroup() %>%
# specify global aesthetic mappings
ggplot(aes(x = year, y = avg_lifeExp)) +
# add a points layer on top
geom_point() +
# add a line layer on top
geom_line()
# Chunk 42
gapminder %>%
group_by(continent, year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
# specify global aesthetic mappings
ggplot() +
# add a points layer on top
geom_point(aes(x = year, y = avg_lifeExp)) +
geom_line(aes(x = year, y = avg_lifeExp, group = continent))
# Chunk 43
gapminder %>%
group_by(continent, year) %>%
summarise(avg_lifeExp = mean(lifeExp))
# Chunk 44
gapminder %>%
group_by(continent, year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
ungroup() %>%
# specify global aesthetic mappings
ggplot() +
# add a points layer on top
geom_point(aes(x = year, y = avg_lifeExp)) +
# add a lines layer ontop
geom_line(aes(x = year, y = avg_lifeExp))
# Chunk 45
gapminder %>%
group_by(continent, year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
# specify global aesthetic mappings
ggplot() +
# add a points layer on top
geom_point(aes(x = year, y = avg_lifeExp)) +
# add a lines layer on top that is grouped by continent
geom_line(aes(x = year, y = avg_lifeExp, group = continent))
# Chunk 46
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap, y = lifeExp),
col = "cornflowerblue")
# Chunk 47
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap,
y = lifeExp,
col  = continent))
# Chunk 48
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap,
y = lifeExp,
col  = continent)) +
scale_colour_manual(values = c("orange", "red", "yellow", "green", "blue"))
# Chunk 49
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap, y = lifeExp,
col = continent, size = pop),
alpha = 0.5)
# Chunk 50
gapminder %>%
group_by(continent, year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
# specify global aesthetic mappings
ggplot() +
# add a points layer on top
geom_line(aes(x = year, y = avg_lifeExp, colour = continent))
# Chunk 51
gapminder %>%
ggplot() +
geom_histogram(aes(x = lifeExp), binwidth = 3)
# Chunk 52
gapminder %>%
ggplot() +
geom_boxplot(aes(x = continent, y = lifeExp, fill = continent))
# Chunk 53
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap, y = lifeExp)) +
facet_wrap(~continent, ncol = 2)
gapminder %>%
filter(year == 2007) %>%
ggplot() +
# add scatter points
geom_point(aes(x = gdpPercap, y = lifeExp, col = continent, size = pop),
alpha = 0.5) +
# add some text annotations for the very large countries
geom_text(aes(x = gdpPercap, y = lifeExp + 3, label = country),
col = "grey50",
data = filter(gapminder, year == 2007, pop > 1000000000 | country %in% c("Nigeria", "United States"))) +
# clean the axes names and breaks
scale_x_log10(limits = c(200, 60000)) +
# change labels
labs(title = "GDP versus life expectancy in 2007",
x = "GDP per capita (log scale)",
y = "Life expectancy",
size = "Population",
col = "Continent") +
# change the size scale
scale_size(range = c(0.1, 10),
# remove size legend
guide = "none") +
# add a nicer theme
theme_classic() +
# place legend at top and grey axis lines
theme(legend.position = "top",
axis.line = element_line(colour = "grey85"),
axis.ticks = element_line(colour = "grey85"))
gapminder_life_exp_diff <- gapminder %>%
# filter to the starting and ending years only
filter(year == 1952 | year == 2007) %>%
# ensure that the data are arranged so that 1952 is first and 2007 is second
# within each year
arrange(country, year) %>%
# for country, add a variable corresponding to the difference between life
# expectency in 2007 and 1952
group_by(country) %>%
mutate(lifeExp_diff = lifeExp[2] - lifeExp[1],
# also calculate the largest population for the country (based on the two years)
max_pop = max(pop)) %>%
ungroup() %>%
# arrange in order of the biggest difference in life expectency
arrange(lifeExp_diff) %>%
# restrict to countries with a population of at least 30,000 so we can fit
# the plot in a reasonable space
filter(max_pop > 30000000) %>%
# redefine the country varaible so that it does not have the additional
# country levels corresponding to countries that were removed in the previous
# step
mutate(country = droplevels(country)) %>%
select(country, year, continent, lifeExp, lifeExp_diff)
gapminder_life_exp_diff %>%
mutate(country = fct_inorder(country)) %>%
# for each country define a varaible for min and max life expectancy
group_by(country) %>%
mutate(max_lifeExp = max(lifeExp),
min_lifeExp = min(lifeExp)) %>%
ungroup() %>%
ggplot() +
# plot a horizontal line from min to max life expectency for each country
geom_segment(aes(x = min_lifeExp, xend = max_lifeExp,
y = country, yend = country,
col = continent), alpha = 0.5, size = 7) +
# add a point for each life expectancy data point
geom_point(aes(x = lifeExp, y = country, col = continent), size = 8) +
# add text of the country name as well as the max and min life expectency
geom_text(aes(x = min_lifeExp + 0.7, y = country,
label = paste(country, round(min_lifeExp))),
col = "grey50", hjust = "right") +
geom_text(aes(x = max_lifeExp - 0.7, y = country,
label = round(max_lifeExp)),
col = "grey50", hjust = "left") +
# ensure that the left-most text is not cut off
scale_x_continuous(limits = c(20, 85)) +
# choose a different colour palette
scale_colour_brewer(palette = "Pastel2") +
# set the title
labs(title = "Change in life expectancy",
subtitle = "Between 1952 and 2007",
x = "Life expectancy (in 1952 and 2007)",
y = NULL,
col = "Continent") +
# remove the grey background
theme_classic() +
# remove the axes and move the legend to the top
theme(legend.position = "top",
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
gapminder %>%
filter(year == 2007) %>%
ggplot() +
# add scatter points
geom_point(aes(x = gdpPercap, y = lifeExp, col = continent, size = pop),
alpha = 0.5) +
# add some text annotations for the very large countries
geom_text(aes(x = gdpPercap, y = lifeExp + 3, label = country),
col = "grey50",
data = filter(gapminder, year == 2007, pop > 1000000000 | country %in% c("Nigeria", "United States"))) +
# clean the axes names and breaks
scale_x_log10(limits = c(200, 60000)) +
# change labels
labs(title = "GDP versus life expectancy in 2007",
x = "GDP per capita (log scale)",
y = "Life expectancy",
size = "Population",
col = "Continent") +
# change the size scale
scale_size(range = c(0.1, 10),
# remove size legend
guide = "none") +
# add a nicer theme
theme_classic() +
# place legend at top and grey axis lines
theme(legend.position = "top")
blogdown::serve_site()
stop_server()
blogdown::stop_server()
gapminder %>%
group_by(continent) %>%
arrange(lifeExp) %>%
ungroup()
gapminder %>%
group_by(continent) %>%
filter(lifeExp > mean(lifeExp)) %>%
ungroup()
gapminder %>%
filter(lifeExp > mean(lifeExp))
gapminder %>%
filter(lifeExp > mean(lifeExp)) %>%
dim
gapminder %>%
group_by(continent) %>%
filter(lifeExp > mean(lifeExp)) %>%
ungroup() %>%
dim()
gapminder %>%
group_by(continent) %>%
filter(lifeExp > mean(lifeExp)) %>%
ungroup() %>%
dim()
gapminder %>%
group_by(continent) %>%
filter(lifeExp > median(lifeExp)) %>%
ungroup() %>%
dim()
gapminder %>%
filter(lifeExp > median(lifeExp)) %>%
dim
gapminder %>%
group_by(continent) %>%
filter(lifeExp > mean(lifeExp)) %>%
ungroup() %>%
dim()
gapminder %>%
filter(lifeExp > mean(lifeExp)) %>%
dim
gapminder %>%
filter(lifeExp > mean(lifeExp))
gapminder %>%
filter(lifeExp > mean(lifeExp))  %>%
head
gapminder %>%
group_by(continent) %>%
filter(lifeExp > mean(lifeExp)) %>%
ungroup() %>%
head
gapminder %>%
group_by(continent) %>%
filter(lifeExp > mean(lifeExp)) %>%
ungroup() %>%
count(continent)
gapminder %>%
filter(lifeExp > mean(lifeExp)) %>%
count(continent)
blogdown::serve_site()
blogdown::stop_server()
View(gapminder_filtered)
gapminder %>%
# calcualte the average life expectency for each year
group_by(year) %>%
summarise(avg_lifeExp = mean(lifeExp)) %>%
ungroup() %>%
# specify global aesthetic mappings
ggplot(aes(x = year, y = avg_lifeExp)) +
# add a points layer on top
geom_point() +
# add a line layer on top
geom_line()
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap,
y = lifeExp,
col  = continent)) +
scale_colour_manual(values = c("orange", "red4", "purple", "green", "blue"))
gapminder %>%
ggplot() +
geom_point(aes(x = gdpPercap,
y = lifeExp,
col  = continent)) +
scale_colour_manual(values = c("orange", "red4", "purple", "darkgreen", "blue"))
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
