---
title:  "mutate_all(), select_if(), summarise_at()... what's the deal with scoped verbs?!"
author: "Rebecca Barter"
output:
  blogdown::html_page:
    toc: true
categories: [dplyr, R, tidyverse]
date: 2019-01-23T23:13:14-05:00
type: "post" 
description: "What's the deal with these mutate_all(), select_if(), summarise_at(), functions? They seem so useful, but there doesn't seem to be a decent explanation of how to use them anywhere on the internet. Turns out, they're called 'scoped verbs' and hopefully this post will become one of many decent explanations of how to use them!" 
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#a-quick-useful-aside-using-shorthand-for-functions">A quick useful aside: Using shorthand for functions</a></li>
<li><a href="#the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria">The _if() scoped variant: perform an operation on variables that satisfy a logical criteria</a>
<ul>
<li><a href="#select_if">select_if()</a></li>
<li><a href="#rename_if">rename_if()</a></li>
<li><a href="#mutate_if">mutate_if()</a></li>
<li><a href="#summarise_if">summarise_if()</a></li>
</ul></li>
<li><a href="#the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name">The _at() scoped variant: perform an operation only on variables specified by name</a>
<ul>
<li><a href="#select-helpers">Select helpers</a></li>
<li><a href="#rename_at">rename_at()</a></li>
<li><a href="#mutate_at">mutate_at()</a></li>
<li><a href="#summarise_at">summarise_at()</a></li>
</ul></li>
<li><a href="#the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once">The _all() scoped variant: perform an operation on all variables at once</a>
<ul>
<li><a href="#rename_all">rename_all()</a></li>
<li><a href="#mutate_all">mutate_all()</a></li>
<li><a href="#summarise_all">summarise_all()</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>

<p>Note: Scoped verbs have now essentially been superseded by <code>accross()</code> (soon to be available in dplyr 1.0.0). See <a href="http://www.rebeccabarter.com/blog/2020-07-09-across/" class="uri">http://www.rebeccabarter.com/blog/2020-07-09-across/</a> for details.</p>
<p>I often find myself wishing that I could apply the same <code>mutate</code> function to several columns in a data frame at once, such as convert all factors to characters, or do something to all columns that have missing values, or select all variables whose names end with <code>_important</code>. When I first googled these problems around a year ago, I started to see solutions that use weird extensions of the basic <code>mutate()</code>, <code>select()</code>, <code>rename()</code>, and <code>summarise()</code> dplyr functions that look like <code>summarise_all()</code>, <code>filter_at()</code>, <code>mutate_if()</code>, and so on. I have since learned that these functions are called <strong>“scoped verbs”</strong> (where “scoped” means that they operate only on a selection of variables).</p>
<p>Unfortunately, despite my extensive googling, I never really found a satisfactory description of <em>how</em> to use these functions in general, I think primarily because the documentation for these functions is not particularly useful (try <code>?mutate_at()</code>).</p>
<p>Fortunately, I recently attended a series of lightening talks hosted by the RLadies SF chapter where Sara Altman pointed us towards a <a href="https://dcl-2017-04.github.io/curriculum/manip-scoped.html">summary document</a> that Hadley Wickham wrote for the Data Science class he helped create at Stanford in 2017 (this class is now taught by Sara Altman herself).</p>
<p>To summarise what I will demonstrate below, there are three scoped variants of the standard <code>mutate</code>, <code>summarise</code>, <code>rename</code> and <code>select</code> (and <code>transmute</code>) dplyr functions that can be specified by the following suffixes:</p>
<ul>
<li><p><code>_if</code>: allows you to pick variables that satisfy some logical criteria such as <code>is.numeric()</code> or <code>is.character()</code> (e.g. summarising only the numeric columns)</p></li>
<li><p><code>_at</code>: allows you to perform an operation only on variables specified by name (e.g. mutating only the columns whose name ends with "_date")</p></li>
<li><p><code>_all</code>: allows you to perform an operation on all variables at once (e.g. calculating the number of missing values in every column)</p></li>
</ul>
<p>To explain how these functions all work, I will use the dataset from a survey of 800 Pittsburgh residents on whether or not they approve of self-driving car companies testing their autonomous vehicles on the streets of Pittsburgh (there have several articles on this issue in recent times in case you missed them: <a href="https://www.wired.com/story/uber-returns-self-driving-after-deadly-crash/">1</a>, <a href="https://www.nytimes.com/2018/12/05/technology/uber-self-driving-cars.html">2</a>). The data can usually be downloaded from data.gov (but is currently unavailable due to the current Government Shutdown - I will update this with an actual link to the data one day). For now you can download the data from <a href="/data/bikepghpublic.csv">here</a>.</p>
<p>A random sample of 10 rows of this dataset is shown below. To make it easy to see what’s going on, I’ll restrict my analysis below to these 10 rows</p>
<pre class="r"><code># load in the only library you ever really need
library(tidyverse)
library(lubridate)
# load in survey data
av_survey &lt;- read_csv(&quot;../data/bikepghpublic.csv&quot;)</code></pre>
<pre class="r"><code>set.seed(45679)
av_survey_sample &lt;- av_survey %&gt;% 
  # select jsut a few columns and give some more intuitive column names
  select(id = `Response ID`,
         start_date = `Start Date`, 
         end_date = `End Date`,
         interacted_with_av_as_pedestrian = InteractPedestrian,
         interacted_with_av_as_cyclist = InteractBicycle,
         circumstanses_of_interaction = CircumstancesCoded, # lol @ typo in data
         approve_av_testing_pgh = FeelingsProvingGround) %&gt;%
  # take a random sample of 10 rows
  sample_n(10) %&gt;%
  # make data frame so that we view the whole thing
  as.data.frame()
av_survey_sample</code></pre>
<pre><code>##           id                 start_date                   end_date
## 1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
##    interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses_of_interaction approve_av_testing_pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                            NA                Approve
## 4                             3       Somewhat Approve
## 5                            NA       Somewhat Approve
## 6                             1                Approve
## 7                            NA                Approve
## 8                            NA    Somewhat Disapprove
## 9                             2                Approve
## 10                           NA    Somewhat Disapprove</code></pre>
<div id="a-quick-useful-aside-using-shorthand-for-functions" class="section level1">
<h1>A quick useful aside: Using shorthand for functions</h1>
<p>For many of the examples below, I will be using the <code>~fun(.x)</code> shorthand for writing temporary functions. If you’ve never seen this shorthand before it’s incredibly useful. As an example, here are three ways of counting the number of missing values in each column of a data frame.</p>
<p>The first approach uses the traditional <code>sapply()</code> function and temporary function syntax.</p>
<pre class="r"><code># using apply and the normal temporary function syntax
sapply(av_survey_sample, function(x) sum(is.na(x)))</code></pre>
<pre><code>##                               id                       start_date 
##                                0                                0 
##                         end_date interacted_with_av_as_pedestrian 
##                                0                                0 
##    interacted_with_av_as_cyclist     circumstanses_of_interaction 
##                                0                                5 
##           approve_av_testing_pgh 
##                                0</code></pre>
<p>The second still uses the temporary function syntax, but is using the <code>map_dbl()</code> function from the <code>purrr</code> package instead of the old-school <code>sapply()</code> function.</p>
<pre class="r"><code># using purrr::map_dbl and the normal temporary function syntax
av_survey_sample %&gt;% map_dbl(function(x) sum(is.na(x)))</code></pre>
<pre><code>##                               id                       start_date 
##                                0                                0 
##                         end_date interacted_with_av_as_pedestrian 
##                                0                                0 
##    interacted_with_av_as_cyclist     circumstanses_of_interaction 
##                                0                                5 
##           approve_av_testing_pgh 
##                                0</code></pre>
<p>The third uses the <code>map_dbl()</code> function with the <code>~fun(.x)</code> syntax.</p>
<pre class="r"><code># using purrr::map_dbl and the `~fun(.x)` temporary function syntax
av_survey_sample %&gt;% map_dbl(~sum(is.na(.x)))</code></pre>
<pre><code>##                               id                       start_date 
##                                0                                0 
##                         end_date interacted_with_av_as_pedestrian 
##                                0                                0 
##    interacted_with_av_as_cyclist     circumstanses_of_interaction 
##                                0                                5 
##           approve_av_testing_pgh 
##                                0</code></pre>
</div>
<div id="the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria" class="section level1">
<h1>The _if() scoped variant: perform an operation on variables that satisfy a logical criteria</h1>
<p><code>_if</code> allows you to perform an operation on variables that satisfy some logical criteria such as <code>is.numeric()</code> or <code>is.character()</code>.</p>
<div id="select_if" class="section level2">
<h2>select_if()</h2>
<p>For instance, we can use <code>select_if()</code> to extract the numeric columns of the tibble only.</p>
<pre class="r"><code>av_survey_sample %&gt;% select_if(is.numeric)</code></pre>
<pre><code>##           id circumstanses_of_interaction
## 1  260381029                            2
## 2  260822947                            4
## 3  260907069                           NA
## 4  261099035                            3
## 5  260332379                           NA
## 6  260355021                            1
## 7  260350676                           NA
## 8  261092370                           NA
## 9  260332519                            2
## 10 260351560                           NA</code></pre>
<p>We could also apply use more complex logical statements, for example by selecting columns that have at least one missing value.</p>
<pre class="r"><code>av_survey_sample %&gt;% 
  # select columns with at least one NA
  # the expression evaluates to TRUE if there is one or more missing values
  select_if(~sum(is.na(.x)) &gt; 0) </code></pre>
<pre><code>##    circumstanses_of_interaction
## 1                             2
## 2                             4
## 3                            NA
## 4                             3
## 5                            NA
## 6                             1
## 7                            NA
## 8                            NA
## 9                             2
## 10                           NA</code></pre>
</div>
<div id="rename_if" class="section level2">
<h2>rename_if()</h2>
<p>We could rename columns that satisfy a logical expression using <code>rename_if()</code>. For instance, we can add a <code>num_</code> prefix to all numeric column names.</p>
<pre class="r"><code>av_survey_sample %&gt;%
  # only rename numeric columns by adding a &quot;num_&quot; prefix
  rename_if(is.numeric, ~paste0(&quot;num_&quot;, .x))</code></pre>
<pre><code>##       num_id                 start_date                   end_date
## 1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
##    interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    num_circumstanses_of_interaction approve_av_testing_pgh
## 1                                 2                Approve
## 2                                 4             Disapprove
## 3                                NA                Approve
## 4                                 3       Somewhat Approve
## 5                                NA       Somewhat Approve
## 6                                 1                Approve
## 7                                NA                Approve
## 8                                NA    Somewhat Disapprove
## 9                                 2                Approve
## 10                               NA    Somewhat Disapprove</code></pre>
</div>
<div id="mutate_if" class="section level2">
<h2>mutate_if()</h2>
<p>We could similarly use <code>mutate_if()</code> to mutate columns that satisfy specified logical conditions. In the example below, we mutate all columns that have at least one missing value by replacing <code>NA</code> with <code>"missing"</code>.</p>
<pre class="r"><code>av_survey_sample %&gt;% 
  # only mutate columns with at least one NA
  # replace each NA value with the character &quot;missing&quot;
  mutate_if(~sum(is.na(.x)) &gt; 0,
            ~if_else(is.na(.x), &quot;missing&quot;, as.character(.x)))</code></pre>
<pre><code>##           id                 start_date                   end_date
## 1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
##    interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses_of_interaction approve_av_testing_pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                       missing                Approve
## 4                             3       Somewhat Approve
## 5                       missing       Somewhat Approve
## 6                             1                Approve
## 7                       missing                Approve
## 8                       missing    Somewhat Disapprove
## 9                             2                Approve
## 10                      missing    Somewhat Disapprove</code></pre>
</div>
<div id="summarise_if" class="section level2">
<h2>summarise_if()</h2>
<p>Similarly, <code>summarise_if()</code> will summarise columns that satisfy the specified logical conditions. Below, we summarise each character column by reporting the most common value (but for some reason there is no <code>mode()</code> function in R, so we need to write our own).</p>
<pre class="r"><code># function to calculate the mode (most common) observation
mode &lt;- function(x) {
  names(sort(table(x)))[1]
}
# summarise character
av_survey_sample %&gt;% 
  summarise_if(is.character, mode)</code></pre>
<pre><code>##                   start_date                   end_date
## 1 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
##   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                         Not sure                      Not sure
##   approve_av_testing_pgh
## 1             Disapprove</code></pre>
</div>
</div>
<div id="the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name" class="section level1">
<h1>The _at() scoped variant: perform an operation only on variables specified by name</h1>
<p><code>_at</code> allows you to perform an operation only on variables specified by name.</p>
<p>To specify which variables you want to operate on, you need to include the variable names inside the <code>vars()</code> function as the first argument. I think of as like <code>vars()</code> like <code>c()</code> to provide multiple values (in this case variable names) as a single argument. For example <code>av_survey_sample %&gt;% mutate_at(vars(start_date, end_date), mdy_hms)</code> will only mutate the <code>start_date</code> and <code>end_date</code> variables by converting them to lubridate format using the <code>mdy_hms</code> function.</p>
<p>These variables can be specified explicitly by name within the <code>vars()</code> function, or using the <strong>select_helpers</strong> within the <code>vars()</code> function.</p>
<div id="select-helpers" class="section level2">
<h2>Select helpers</h2>
<p>Select helpers are functions that you can use within <code>select()</code> to help specify which variables you want to select. The options are</p>
<ul>
<li><p><code>starts_with()</code>: select all variables that start with a specified character string</p></li>
<li><p><code>ends_with()</code>: select all variables that end with a specified character string</p></li>
<li><p><code>contains()</code>: select all variables that contain a specified character string</p></li>
<li><p><code>matches()</code>: select variables that match a specified character string</p></li>
<li><p><code>one_of()</code>: selects variables that match any entries in the specified character vector</p></li>
<li><p><code>num_range()</code>: selects variables that are numbered (e.g. columns named <code>V1</code>, <code>V2</code>, <code>V3</code> would be selected by <code>select(num_range("V", 1:3))</code>)</p></li>
</ul>
<p>There are many ways that we could select the <code>date</code> variables using the <code>ends_with()</code> and <code>contains()</code> select helpers:</p>
<pre class="r"><code># selecting the date columns by providing their names
av_survey_sample %&gt;% select(start_date, end_date)</code></pre>
<pre><code>##                    start_date                   end_date
## 1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
<pre class="r"><code># selecting the columns that end with &quot;_date&quot;
av_survey_sample %&gt;% select(ends_with(&quot;_date&quot;))</code></pre>
<pre><code>##                    start_date                   end_date
## 1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
<pre class="r"><code># selecting the columns that contain &quot;date&quot;
av_survey_sample %&gt;% select(contains(&quot;date&quot;))</code></pre>
<pre><code>##                    start_date                   end_date
## 1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
<p>If you ever find yourself wanting to provide variable names as characters, the <code>matches()</code> and <code>one_of()</code> select helpers can help you do that.</p>
<pre class="r"><code># provide matches with a single character variables
variable &lt;- &quot;start_date&quot;
av_survey_sample %&gt;% select(matches(variable))</code></pre>
<pre><code>##                    start_date
## 1   02/24/2017 3:14:19 AM PST
## 2   03/03/2017 7:08:33 AM PST
## 3   03/06/2017 5:57:07 PM PST
## 4   03/08/2017 3:05:41 PM PST
## 5   02/23/2017 9:09:11 AM PST
## 6  02/23/2017 10:11:52 PM PST
## 7   02/23/2017 6:10:42 PM PST
## 8  03/08/2017 11:22:43 AM PST
## 9   02/23/2017 9:16:14 AM PST
## 10  02/23/2017 6:40:54 PM PST</code></pre>
<pre class="r"><code># provide one_of with a vector of character variables
variables &lt;- c(&quot;start_date&quot;, &quot;end_date&quot;)
av_survey_sample %&gt;% select(one_of(variables))</code></pre>
<pre><code>##                    start_date                   end_date
## 1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
<p>Note that technically there does exist a <code>select_at()</code> function that requires a <code>vars()</code> input, but I can’t really think of a good use of this function…</p>
<pre class="r"><code># this is the same as av_survey_sample %&gt;% select(start_date, end_date)
av_survey_sample %&gt;% 
  select_at(vars(start_date, end_date))</code></pre>
<pre><code>##                    start_date                   end_date
## 1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
<p>The syntax of this <code>select_at()</code> example though can be useful for understanding how the <code>vars()</code> function can be used in the other <code>_at()</code> functions).</p>
</div>
<div id="rename_at" class="section level2">
<h2>rename_at()</h2>
<p>You can rename specified variables using the <code>rename_at()</code> function. For instance, we could replace all column names that contain the character string “av” with the same column name but an uppercase “AV” instead of the original lowercase “av”.</p>
<p>To do this, we use the select helper <code>contains()</code> within the <code>vars()</code> function.</p>
<pre class="r"><code># use a select helper to only apply to columns whose name contains &quot;av&quot;
# then rename these columns with &quot;AV&quot; in place of &quot;av&quot;
av_survey_sample %&gt;% 
  rename_at(vars(contains(&quot;av&quot;)), 
            ~gsub(&quot;av&quot;, &quot;AV&quot;, .x))</code></pre>
<pre><code>##           id                 start_date                   end_date
## 1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
##    interacted_with_AV_as_pedestrian interacted_with_AV_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses_of_interaction approve_AV_testing_pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                            NA                Approve
## 4                             3       Somewhat Approve
## 5                            NA       Somewhat Approve
## 6                             1                Approve
## 7                            NA                Approve
## 8                            NA    Somewhat Disapprove
## 9                             2                Approve
## 10                           NA    Somewhat Disapprove</code></pre>
</div>
<div id="mutate_at" class="section level2">
<h2>mutate_at()</h2>
<p>To mutate only the date variables, normally we would do the <code>mdy_hms()</code> transformation to each variable separately as follows:</p>
<pre class="r"><code># use the standard (unscoped) approach
av_survey_sample %&gt;% 
  mutate(start_date = mdy_hms(start_date),
         end_date = mdy_hms(end_date))</code></pre>
<pre><code>##           id          start_date            end_date
## 1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
## 2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
## 3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
## 4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
## 5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
## 6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
## 7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
## 8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
## 9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
## 10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
##    interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses_of_interaction approve_av_testing_pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                            NA                Approve
## 4                             3       Somewhat Approve
## 5                            NA       Somewhat Approve
## 6                             1                Approve
## 7                            NA                Approve
## 8                            NA    Somewhat Disapprove
## 9                             2                Approve
## 10                           NA    Somewhat Disapprove</code></pre>
<p>However, using <code>mutate_at()</code> and supplying these column names as arguments to the <code>vars()</code> function, we could specify the function only once.</p>
<pre class="r"><code># specifying specific variables to apply the same function to
av_survey_sample %&gt;% 
  mutate_at(vars(start_date, end_date), mdy_hms)</code></pre>
<pre><code>##           id          start_date            end_date
## 1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
## 2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
## 3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
## 4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
## 5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
## 6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
## 7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
## 8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
## 9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
## 10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
##    interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses_of_interaction approve_av_testing_pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                            NA                Approve
## 4                             3       Somewhat Approve
## 5                            NA       Somewhat Approve
## 6                             1                Approve
## 7                            NA                Approve
## 8                            NA    Somewhat Disapprove
## 9                             2                Approve
## 10                           NA    Somewhat Disapprove</code></pre>
<p>Moreover, we can use the select helpers to specify which columns we want to mutate, without having to write out the entire column names.</p>
<pre class="r"><code># use a &quot;select helper&quot; to specify the variables that end with &quot;_date&quot;
av_survey_sample %&gt;% 
  mutate_at(vars(ends_with(&quot;_date&quot;)), mdy_hms)</code></pre>
<pre><code>##           id          start_date            end_date
## 1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
## 2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
## 3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
## 4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
## 5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
## 6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
## 7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
## 8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
## 9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
## 10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
##    interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses_of_interaction approve_av_testing_pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                            NA                Approve
## 4                             3       Somewhat Approve
## 5                            NA       Somewhat Approve
## 6                             1                Approve
## 7                            NA                Approve
## 8                            NA    Somewhat Disapprove
## 9                             2                Approve
## 10                           NA    Somewhat Disapprove</code></pre>
</div>
<div id="summarise_at" class="section level2">
<h2>summarise_at()</h2>
<p>The <code>summarise_at()</code> scoped verb behaves very similarly to the <code>mutate_at()</code> scoped verb, in that we can easily specify <em>which</em> variables we want to apply the same summary function to.</p>
<p>For instance, the following example summarises all variables that contain the word “interacted” by counting the number of “Yes” entries.</p>
<pre class="r"><code>av_survey_sample %&gt;% 
  summarise_at(vars(contains(&quot;interacted&quot;)), ~sum(.x == &quot;Yes&quot;))</code></pre>
<pre><code>##   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
## 1                                4                             6</code></pre>
</div>
</div>
<div id="the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once" class="section level1">
<h1>The _all() scoped variant: perform an operation on all variables at once</h1>
<p><code>_all</code> allows you to perform an operation on all variables at once (e.g. calculating the number of missing values in every column).</p>
<div id="rename_all" class="section level2">
<h2>rename_all()</h2>
<p>The <code>select_all()</code> would is quite redundant (it would simply return all columns). Its friend <code>rename_all()</code>, however can be very useful.</p>
<p>For instance, we could rename all variables by replacing underscores <code>_</code> with dots <code>.</code> (although I would advise against this: underscores are way better than dots!).</p>
<pre class="r"><code>av_survey_sample %&gt;% 
  rename_all(~gsub(&quot;_&quot;, &quot;.&quot;, .x))</code></pre>
<pre><code>##           id                 start.date                   end.date
## 1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
## 2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
## 3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
## 4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
## 5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
## 6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
## 7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
## 8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
## 9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
## 10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
##    interacted.with.av.as.pedestrian interacted.with.av.as.cyclist
## 1                               Yes                           Yes
## 2                                No                           Yes
## 3                               Yes                           Yes
## 4                                No                           Yes
## 5                                No                           Yes
## 6                               Yes                           Yes
## 7                                No                            No
## 8                          Not sure                      Not sure
## 9                               Yes                            No
## 10                               No                            No
##    circumstanses.of.interaction approve.av.testing.pgh
## 1                             2                Approve
## 2                             4             Disapprove
## 3                            NA                Approve
## 4                             3       Somewhat Approve
## 5                            NA       Somewhat Approve
## 6                             1                Approve
## 7                            NA                Approve
## 8                            NA    Somewhat Disapprove
## 9                             2                Approve
## 10                           NA    Somewhat Disapprove</code></pre>
</div>
<div id="mutate_all" class="section level2">
<h2>mutate_all()</h2>
<p>We could apply the same mutate function to every column at once using <code>mutate_all()</code>. For instance, the code below converts every column to a numeric (although this results in mostly missing values for the character variables)</p>
<pre class="r"><code>av_survey_sample %&gt;%
  mutate_all(as.numeric)</code></pre>
<pre><code>##           id start_date end_date interacted_with_av_as_pedestrian
## 1  260381029         NA       NA                               NA
## 2  260822947         NA       NA                               NA
## 3  260907069         NA       NA                               NA
## 4  261099035         NA       NA                               NA
## 5  260332379         NA       NA                               NA
## 6  260355021         NA       NA                               NA
## 7  260350676         NA       NA                               NA
## 8  261092370         NA       NA                               NA
## 9  260332519         NA       NA                               NA
## 10 260351560         NA       NA                               NA
##    interacted_with_av_as_cyclist circumstanses_of_interaction
## 1                             NA                            2
## 2                             NA                            4
## 3                             NA                           NA
## 4                             NA                            3
## 5                             NA                           NA
## 6                             NA                            1
## 7                             NA                           NA
## 8                             NA                           NA
## 9                             NA                            2
## 10                            NA                           NA
##    approve_av_testing_pgh
## 1                      NA
## 2                      NA
## 3                      NA
## 4                      NA
## 5                      NA
## 6                      NA
## 7                      NA
## 8                      NA
## 9                      NA
## 10                     NA</code></pre>
</div>
<div id="summarise_all" class="section level2">
<h2>summarise_all()</h2>
<p>We could also apply the same summary function to every column at once using <code>summarise_all()</code>. For instance, the example below calculates the number of distinct entries in each column.</p>
<pre class="r"><code>av_survey_sample %&gt;%
  summarise_all(n_distinct)</code></pre>
<pre><code>##   id start_date end_date interacted_with_av_as_pedestrian
## 1 10         10       10                                3
##   interacted_with_av_as_cyclist circumstanses_of_interaction
## 1                             3                            5
##   approve_av_testing_pgh
## 1                      4</code></pre>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>Hopefully this summary is useful to you in your data manipulation adventures!</p>
</div>
